# AI短剧素材生成系统 - 详细开发规划

## 一、项目概述

**系统定位**：AI作为专业短剧编剧+导演，基于MiniMax AI能力，将小说自动改编为抖音竖屏短剧素材

**核心目标**：
- 极致自动化：用户只提供小说内容，AI完成所有工作
- 质量可控：分集规划和剧本可审核，保证合格线以上质量
- 高效产出：追求速度，快速迭代

## 二、系统配置参数（最终确认）

```
┌────────────────────┬──────────────────────┐
│ 配置项            │ 推荐标准            │
├────────────────────┼──────────────────────┤
│ 单集时长          │ 3-5分钟             │
│ 分镜头数          │ 5-8个镜头           │
│ 镜头时长          │ 30-60秒/镜头        │
│ 爽点密度          │ 每10秒一个爽点      │
│ 视频比例          │ 9:16竖屏            │
│ 视频分辨率        │ 1080x1920           │
│ 角色数量          │ 1-2个主角+反派      │
│ 钩子时效          │ 3秒内抛出核心冲突   │
│ 悬念设置          │ 每集结尾必设钩子    │
└────────────────────┴──────────────────────┘
```

## 三、项目结构设计

```
ai_short_drama/
├── core/                          # 核心模块
│   ├── script_generator.py         # 剧本生成器
│   ├── chapter_analyzer.py        # 章节分析器
│   ├── episode_planner.py          # 分集规划器
│   ├── scene_optimizer.py          # 场景优化器
│   ├── emotion_manager.py          # 情绪管理器
│   └── character_manager.py       # 角色管理器
├── generators/                    # 生成器模块
│   ├── image_generator.py         # 图像生成
│   ├── video_generator.py         # 视频生成
│   ├── audio_generator.py         # 音频生成
│   └── material_organizer.py     # 素材整理
├── templates/                     # Prompt模板
│   ├── script_prompts.py          # 剧本相关Prompt
│   ├── image_prompts.py           # 图像相关Prompt
│   └── audio_prompts.py           # 音频相关Prompt
├── utils/                         # 工具模块
│   ├── file_manager.py            # 文件管理
│   ├── validator.py               # 参数验证
│   ├── retry_manager.py           # 重试管理
│   └── progress_tracker.py       # 进度跟踪
├── data/                          # 数据模型
│   ├── models.py                 # 数据结构定义
│   └── schemas.py                # JSON Schema
├── workflow.py                    # 主工作流
├── cli.py                         # 命令行接口
├── config.py                      # 配置文件
├── requirements.txt               # 依赖列表
└── README.md                      # 使用说明
```

## 四、核心功能模块详解

### 4.1 章节分析模块
```python
功能：分析小说章节，评估剧情密度

输入：小说文本
输出：章节分析报告
  - 剧情密度分数（0-100）
  - 对话比例
  - 冲突事件数
  - 情感强度
  - 预计时长

算法：
1. 使用NLP识别章节结构
2. 统计对话、描写、心理活动比例
3. 识别冲突事件（争吵、打斗、反转等）
4. 计算情感波动强度
5. 评估剧情推进速度
```

### 4.2 分集规划模块
```python
功能：根据章节分析结果，智能规划分集策略

输入：章节分析报告
输出：分集规划
  - 每集包含的章节范围
  - 规划理由（高密度/合并/压缩）
  - 预计镜头数
  - 预计时长

决策规则：
if 章节密度 > 70分:
    单独成集（高密度章节，内容丰富）
elif 章节密度 > 40分:
    2-3章合并（中等密度）
else:
    3-4章压缩合并（低密度，大幅压缩）
```

### 4.3 剧本生成模块
```python
功能：将小说章节改编为抖音短剧剧本

输入：小说章节内容 + 目标参数
输出：结构化剧本JSON

关键步骤：
1. 识别核心冲突点（过滤冲突强度>=7分）
2. 极致压缩剧情（去除30%非核心内容）
3. 拆分5-8个镜头
4. 强制添加短剧规范：
   - 开篇3秒钩子
   - 每10秒一个小反转
   - 结尾悬念钩子
5. 标注情绪类型和强度
6. 生成说书人旁白
7. 生成角色对话
```

### 4.4 角色管理模块
```python
功能：识别角色并分配音色

输入：章节内容
输出：角色配置
  - 角色ID
  - 角色姓名
  - 性格特征
  - 外貌描述
  - 分配音色ID
  - 默认情绪

音色映射规则：
主角男 → male-qn-qingse（青年男）
主角女 → female-chengshu（程姝）
反派 → male-qn-qingse + emotion=arrogant
配角 → 根据性格匹配系统音色
```

### 4.5 图像生成模块
```python
功能：生成9:16竖屏素材

角色图片：
- 首次生成：使用image()生成基础形象
- 后续场景：使用image(reference_image=...)保持一致性
- 参数：aspect_ratio="9:16", width=1080, height=1920

场景图片：
- 描述：简化背景，突出人物
- 参数：aspect_ratio="9:16", 风格根据情绪选择
- 构图：人物居中或略偏，适合竖屏观看
```

### 4.6 视频生成模块
```python
功能：生成9:16竖屏视频

技术路线：
- 使用image_to_video()（图生视频）
- 模型：I2V-01-Director（支持运镜控制）
- 时长：6秒/镜头（可通过首尾帧拼接更长）
- 分辨率：1080P
- 运镜指令：根据镜头类型自动选择

运镜映射：
对话场景 → 固定镜头
情绪增强 → 推进镜头
场景转换 → 拉远镜头
动作场景 → 跟随镜头
紧张时刻 → 晃动镜头
```

### 4.7 音频生成模块
```python
功能：生成音频素材

说书人音频：
- 音色：male-qn-qingse（男播音员）
- 情感：fluent（生动讲述）
- 语速：1.2倍速（快节奏）
- 格式：mp3, 32000Hz, 128kbps

角色配音：
- 音色：根据角色分配
- 情感：根据对话情绪
- 格式：mp3, 32000Hz, 128kbps

背景音乐：
- 类型：紧张/爽快/甜蜜/悬疑（4种循环）
- 时长：每集总时长
- 音量：-20dB（不喧宾夺主）

音效：
- 类型：打脸/震惊/心跳/揭晓等
- 触发时机：关键冲突点自动添加
```

### 4.8 素材整理模块
```python
功能：按镜头顺序组织素材，便于剪辑

输出结构：
episode_XX_materials/
├── script.json                    # 剧本JSON
├── script_summary.txt             # 剧本摘要
├── scenes/                        # 按镜头顺序
│   ├── scene_01/
│   │   ├── video_vertical.mp4
│   │   ├── narrator_audio.mp3
│   │   ├── char_audio.mp3
│   │   ├── bgm.mp3
│   │   ├── sfx.mp3
│   │   └── scene_image.jpg
│   └── ...
├── characters/                    # 角色参考图
│   ├── char1_vertical.jpg
│   └── char2_vertical.jpg
├── bgm_library/                   # BGM库
│   ├── bgm_tense.mp3
│   └── bgm_happy.mp3
└── README.txt                     # 使用说明
```

## 五、数据结构设计

### 5.1 剧本JSON Schema
```json
{
  "episode_info": {
    "episode_number": 1,
    "title": "第一章：废物赘婿的逆袭",
    "source_chapters": [1, 2],
    "target_duration": 240,
    "hook_type": "身份揭秘",
    "cliffhanger_type": "幕后黑手"
  },
  "characters": [
    {
      "id": "char1",
      "name": "林凡",
      "type": "protagonist",
      "personality": ["隐忍", "腹黑"],
      "voice_id": "male-qn-qingse",
      "reference_image": "林凡_reference.jpg"
    }
  ],
  "scenes": [
    {
      "scene_id": 1,
      "duration": 45,
      "timing_range": [0, 45],
      "hook": true,
      "hook_text": "你就是那个废物赘婿？",
      "conflict_level": 9,
      "emotion_type": "爽",
      "emotion_intensity": 8,
      "narrator": "豪门别墅大厅，所有宾客都在嘲笑...",
      "dialogues": [
        {
          "character": "char1",
          "text": "废物？",
          "emotion": "冷笑"
        }
      ],
      "visual_prompt": "豪宅大厅，众人嘲讽表情",
      "camera_action": "推进",
      "twists": [
        {"timing": 10, "description": "林凡眼神一变"},
        {"timing": 30, "description": "展示实力"}
      ],
      "bgm_type": "紧张",
      "sfx": ["slap", "gasp"]
    }
  ]
}
```

## 六、工作流程设计

### 6.1 完整工作流
```
用户操作：
1. 提供小说文件（支持txt/md/pdf）
   ↓
AI自动处理：
2. 章节分析 + 分集规划
   - 识别章节结构
   - 评估剧情密度
   - 提出分集建议
   ↓
3. 展示分集规划
   - 每集包含的章节
   - 规划理由
   - 预计时长
   ↓
用户审核：
4. 确认/调整分集规划
   - 可选择AI建议/手动指定/混合模式
   ↓
AI自动处理：
5. 逐集生成剧本
   - 剧情压缩
   - 镜头拆分
   - 添加短剧规范
   - 标注情绪
   ↓
用户审核：
6. 逐集审核剧本
   - 检查爽点
   - 检查节奏
   - 可调整/重新生成
   ↓
AI自动处理：
7. 生成素材
   - 角色图片（9:16竖屏）
   - 场景图片
   - 分镜头视频
   - 说书人音频
   - 角色配音
   - 背景音乐
   - 音效
   ↓
8. 整理输出
   - 按镜头顺序组织
   - 生成使用说明
   ↓
用户：
9. 使用剪映等工具剪辑
```

## 七、Prompt模板库

### 7.1 剧本生成Prompt
```
你是专业的抖音短剧编剧，擅长将小说改编为3-5分钟的竖屏短剧。

改编原则（必须遵守）：
1. 极致压缩：只保留核心冲突和爽点，去除所有冗余
2. 节奏超快：3秒抛钩子，30秒冲突，结尾悬念
3. 爽点密度：每10秒一个小反转/爽点
4. 情绪导向：每镜头标注情绪类型和强度（1-10分）
5. 角色扁平：人设鲜明，行为单一（打脸/复仇/恋爱）

输出要求：
- 拆分5-8个镜头
- 每镜头30-60秒
- 开篇钩子：3秒内抓住眼球
- 结尾悬念：身份揭晓/幕后黑手/重大转折
- JSON格式输出（严格遵循schema）

请将以下内容改编为抖音短剧剧本：
{novel_content}

目标：{target_scenes}个镜头，总时长{target_duration}秒
```

### 7.2 其他Prompt模板
- 情绪分类Prompt
- 运镜推荐Prompt
- 角色描述Prompt
- 场景视觉Prompt
- 对话生成Prompt
- 旁白生成Prompt

## 八、技术优化点

### 8.1 性能优化
- 并行生成角色图片和场景图片
- 并行生成音频素材
- 带重试机制的API调用
- 智能缓存已生成素材

### 8.2 错误恢复
- API调用失败自动重试（最多3次）
- 生成失败提供详细错误信息
- 支持断点续传
- 生成进度保存

### 8.3 质量控制
- 生成的剧本自动检测是否符合短剧规范
- 视频生成前自动验证参数
- 音频生成前自动验证文本长度
- 提供质量评分报告

## 九、用户交互设计

### 9.1 命令行界面
```bash
# 自动化流程
python ai_short_drama.py novel.txt --auto

# 交互式流程
python ai_short_drama.py novel.txt --interactive

# 分步骤执行
python ai_short_drama.py novel.txt --plan-only
python ai_short_drama.py novel.txt --episode 1
```

### 9.2 交互流程示例
```
=== AI短剧素材生成系统 ===

📖 正在读取小说文件：novel.txt
✅ 识别到 15 个章节

📊 正在分析剧情密度...
✅ 分析完成

📋 分集规划建议：

第1集：第1-2章合并
  - 理由：铺垫阶段，剧情较轻
  - 预计镜头：6个
  - 预计时长：4分钟

第2集：第3章单独
  - 理由：关键转折，冲突密集
  - 预计镜头：8个
  - 预计时长：5分钟

...

❓ 是否确认分集规划？(y/n): y

✅ 开始生成剧本...

=== 第1集剧本生成 ===
📝 识别到 3 个角色
🎬 生成了 6 个镜头

❓ 剧本是否满意？(y/n/r): y

🎨 开始生成素材...
✅ 素材生成完成

📁 输出位置：./episode_01_materials/
```

## 十、开发里程碑

### 第一阶段：核心架构搭建（预计2-3天）
- [ ] 项目结构搭建
- [ ] 数据模型定义
- [ ] 章节分析模块
- [ ] 分集规划模块

### 第二阶段：剧本生成（预计2-3天）
- [ ] 剧本生成模块
- [ ] 角色管理模块
- [ ] 情绪管理模块
- [ ] Prompt模板库

### 第三阶段：素材生成（预计3-4天）
- [ ] 图像生成模块
- [ ] 视频生成模块
- [ ] 音频生成模块
- [ ] 素材整理模块

### 第四阶段：工作流集成（预计2天）
- [ ] 主工作流
- [ ] CLI接口
- [ ] 配置管理
- [ ] 错误处理

### 第五阶段：测试优化（预计1-2天）
- [ ] 单元测试
- [ ] 集成测试
- [ ] 性能优化
- [ ] 文档完善

**总计：预计10-14天完成第一版**

## 十一、已知限制

1. **字幕生成**：不实现自动字幕，用户自行添加
2. **视频拼接**：不实现自动视频拼接，用户使用剪映等工具
3. **长视频**：单镜头最长6秒，多镜头需要首尾帧拼接
4. **角色一致性**：依赖reference_image参数，可能需要手动调整
5. **质量上限**：追求合格线以上，快速迭代优先

## 十二、后续优化方向（第二版）

1. 自动字幕生成（集成ASR）
2. 自动视频拼接（集成FFmpeg）
3. 多角色交互场景（支持复杂对话）
4. 实时预览（生成过程可视化）
5. 质量评分系统（更精准的质量控制）
6. 用户偏好学习（根据用户反馈调整生成策略）

---

## 开发开始时间
2026年02月04日 16:52

## 实现步骤记录

### 第一阶段：项目基础搭建 ✅ 完成

#### 1.1 创建项目结构 ✅
- 创建了完整的目录结构：ai_short_drama/{core,generators,templates,utils,data}
- 创建了基础文件：workflow.py, cli.py, config.py, requirements.txt, README.md

#### 1.2 创建基础配置文件 ✅
- requirements.txt：定义了依赖包
- config.py：完整配置文件，包含：
  - DRAMA_CONFIG：短剧生成标准配置
  - VOICE_MAPPING：音色映射配置
  - CAMERA_MAPPING：运镜映射配置
  - EMOTION_TYPES：情绪类型配置
  - MODEL_CONFIG：模型配置

#### 1.3 创建数据模型 ✅
- data/models.py：完整的数据模型定义
  - Character：角色模型
  - Dialogue：对话模型
  - Twist：反转/爽点模型
  - Scene：场景/镜头模型
  - EpisodeInfo：剧集信息模型
  - Script：剧本模型
  - ChapterAnalysis：章节分析模型
  - EpisodePlan：分集规划模型
  - DramaPlan：整体剧集规划模型
  - MaterialSet：素材集合模型

#### 1.4 基础架构验证 ✅
- 创建了 test_basic.py 测试文件
- 验证了模块导入和数据模型
- 基础架构搭建完成并测试通过

### 第二阶段：核心模块实现 🔄 进行中

#### 2.1 章节分析模块 🔄 开发中
- 文件：core/chapter_analyzer.py
- 类：ChapterAnalyzer
- 功能：
  - analyze_chapter(): 分析单个章节
  - analyze_multiple_chapters(): 分析多个章节
  - _calculate_dialogue_ratio(): 计算对话比例
  - _count_conflict_events(): 统计冲突事件
  - _calculate_emotion_intensity(): 计算情感强度
  - _calculate_density_score(): 计算密度分数
  - _estimate_duration(): 估算时长
  - _extract_key_events(): 提取关键事件

**开发状态**：代码框架已完成，需要修复导入路径和语法错误

#### 2.2 剧本生成模块 ⏳ 待实现
- 文件：core/script_generator.py
- 类：ScriptGenerator
- 功能：将小说章节改编为抖音短剧剧本

#### 2.3 角色管理模块 ⏳ 待实现
- 文件：core/character_manager.py
- 类：CharacterManager
- 功能：识别角色并分配音色

#### 2.4 分集规划模块 ⏳ 待实现
- 文件：core/episode_planner.py
- 类：EpisodePlanner
- 功能：根据章节分析结果，智能规划分集策略

#### 2.5 场景优化模块 ⏳ 待实现
- 文件：core/scene_optimizer.py
- 类：SceneOptimizer
- 功能：极致压缩剧情，添加短剧规范

#### 2.6 情绪管理模块 ⏳ 待实现
- 文件：core/emotion_manager.py
- 类：EmotionManager
- 功能：分析和管理剧本情绪

### 第三阶段：生成器模块实现 ⏳ 待实现

### 第四阶段：工作流集成 ⏳ 待实现

### 第五阶段：测试优化 ⏳ 待实现

---

## 当前遇到的问题

1. **导入路径问题**：在core模块中导入data和config需要正确的相对路径
2. **语法错误**：章节分析模块中存在列表语法错误
3. **编码问题**：Windows终端中文字符编码问题

## 下一步计划

1. **修复章节分析模块**：解决导入和语法问题
2. **完善章节分析功能**：添加更智能的剧情密度评估
3. **实现剧本生成模块**：核心功能，基于MiniMax AI API
4. **集成测试**：验证章节分析+剧本生成流程

## 技术要点记录

### 章节分析算法设计
- **对话比例**：使用正则表达式匹配中文对话格式
- **冲突统计**：基于关键词匹配统计冲突事件
- **情感强度**：使用情感词汇分级计算情感强度
- **密度分数**：加权计算（对话30% + 冲突40% + 情感30%）
- **时长估算**：基于字数和密度分数调整

### 配置参数标准化
- 单集时长：3-5分钟（180-300秒）
- 分镜头数：5-8个镜头
- 镜头时长：30-60秒
- 爽点密度：每10秒一个爽点
- 视频规格：9:16竖屏，1080x1920

---

## 实现优先级

### 高优先级（第一版必须）
1. 章节分析与分集规划
2. 剧本生成（符合短剧规范）
3. 角色图片生成（9:16竖屏）
4. 场景视频生成（图生视频）
5. 音频生成（说书人+角色）
6. 素材整理（便于剪辑）

### 中优先级（如有时间）
1. 并行处理优化
2. 错误恢复机制
3. 进度可视化
4. 质量评分

### 低优先级（第二版）
1. 自动字幕
2. 视频拼接
3. 实时预览
4. 用户偏好学习