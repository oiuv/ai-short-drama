# 灵影短剧系统 v1.0

> AI漫剧智能创作系统 - 端到端小说改编AI漫剧自动化创作平台

## 📖 项目简介

**灵影短剧系统**是一个专注于小说改编AI漫剧的端到端自动化创作系统。用户只需提供小说内容，系统即可自动生成可直接剪辑成片的配音和视频素材。

### 核心功能

- **📖 小说处理**：自动读取、解析、提炼小说内容
- **📝 剧本创作**：AI驱动的多阶段剧本生成流程
- **👤 角色管理**：智能角色卡创建和管理
- **🎬 分镜设计**：专业级场景分镜和运镜规划
- **🎵 音频生成**：故事讲解、角色对话、音效、BGM
- **🎥 视频生成**：角色图、场景图、分镜视频

### 技术栈

- **AI模型**：MiniMax M2-her（文本）、speech-2.6-hd（语音）、image-01（图像）、I2V-01-Director（视频）
- **开发语言**：Python 3.8+
- **数据处理**：Pandas、NumPy
- **视频处理**：FFmpeg、OpenCV
- **API集成**：requests

---

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行小说拆分

```bash
cd novel_splitter
python cli.py --input "../../ebook/《小说名》.txt"
```

### 运行主系统

```bash
python cli.py --style ancient --episode-count 10
```

---

## 📁 项目结构

```
lingying_drama/
├── README.md                           # 项目文档
├── config.py                           # 系统配置
├── requirements.txt                     # 依赖包
├── cli.py                              # 主命令行接口
├── workflow.py                          # 工作流编排
│
├── core/                               # 核心功能模块
│   ├── novel_processor/               # 小说处理模块
│   ├── script_creator/                # 剧本创作模块
│   ├── character_manager/             # 角色管理模块
│   └── storyboard/                   # 分镜设计模块
│
├── generators/                         # 生成器模块
│   ├── audio_generator/               # 音频生成
│   └── video_generator/               # 视频生成
│
├── api/                               # API集成
│   ├── minimax_client.py              # MiniMax API客户端
│   └── prompts.py                    # Prompt模板库
│
├── utils/                             # 工具模块
│   ├── prompt_manager.py              # 提示词管理器
│   ├── file_handler.py               # 文件处理
│   └── logger.py                    # 日志工具
│
├── data/                              # 数据目录
│   └── prompts/                      # 提示词库
│       ├── base/                     # 基础风格提示词
│       │   ├── default/              # 默认风格
│       │   ├── ancient/              # 古风风格
│       │   ├── modern/               # 现代风格
│       │   ├── scifi/                # 科幻风格
│       │   └── wuxia/                # 武侠风格
│       └── templates/                # 用户提示词模板
│
├── novel_splitter/                    # 小说拆分工具
│   ├── core/
│   └── cli.py
│
└── output/                            # 输出目录
    ├── novels/                        # 拆分后的小说
    ├── scripts/                       # 生成的剧本
    ├── materials/                     # 生成的素材
    └── final/                         # 最终输出
```

---

## 🔄 完整工作流程

### 30章 → 1集的端到端流程

```
1. 小说分章读取
   ↓
2. 剧情梗概生成（30章 → 梗概）
   ↓
3. 核心元素提取（梗概 → 人设/设定）
   ↓
4. 故事线拆解（梗概 → 主线/支线）
   ↓
5. 卡点剧情识别（故事线 → 高潮/反转）
   ↓
6. 细纲生成（故事线+卡点 → 细纲）
   ↓
7. 集纲生成（细纲 → 集纲，每集3-5章）
   ↓
8. 短剧正文生成（集纲+角色卡 → 剧本）
   ↓
9. 剧本优化（剧本 → 优化后的剧本）
   ↓
10. 场景分镜生成（剧本 → 分镜）
   ↓
11. 运镜动作规划（分镜 → 运镜指令）
   ↓
12. 视觉描述生成（分镜 → 图像Prompt）
   ↓
13. 角色图像生成（角色卡+Prompt → 角色图）
   ↓
14. 场景图像生成（场景+Prompt → 场景图）
   ↓
15. 故事讲解配音生成（旁白 → 音频）
   ↓
16. 角色对话配音生成（对话 → 音频）
   ↓
17. 音效生成（场景+动作 → 音效）
   ↓
18. 背景音乐推荐（情绪 → BGM）
   ↓
19. 分镜视频生成（图像+运镜 → 视频）
   ↓
20. 素材组织（所有素材 → 素材包）
   ↓
✅ 输出：可直接剪辑成片的配音和视频素材
```

---

## 🎯 功能模块详解

### 📖 模块一：小说处理模块

#### 1.1 小说分章读取处理器
- 批量读取章节文件
- 文本预处理（去重、分段）
- 章节元数据提取
- 支持按范围读取（如30章一批）

#### 1.2 剧情梗概生成器
- AI摘要生成（使用MiniMax M2-her模型）
- 保留关键情节转折点
- 控制梗概长度（300-500字）
- 标记重要角色出场

#### 1.3 核心元素提取器
- 角色提取（姓名、性格、外貌）
- 设定提取（地点、物品、能力）
- 世界观元素（背景设定、规则）
- 关系提取（角色之间的关系）

#### 1.4 故事线拆解器
- 主线故事识别
- 支线故事识别
- 伏笔标记
- 时间线整理

#### 1.5 卡点剧情识别器
- 高潮识别（情绪峰值）
- 反转识别（情势突变）
- 爽点识别（主角胜利时刻）
- 悬念识别（钩子结尾）

---

### 📝 模块二：剧本创作模块

#### 2.1 细纲生成器
- 多线合并
- 节奏调整
- 删除冗余
- 强化冲突

#### 2.2 集纲生成器
- 章节分组（每集3-5章）
- 集数规划（确保每集有高潮）
- 钩子设计（集末悬念）
- 节奏把控（每集时长预估）

#### 2.3 短剧正文生成器
- 场景拆分（每集5-8个场景）
- 对话生成（符合角色性格）
- 旁白生成（推进剧情）
- 动作描述（视觉化描述）

#### 2.4 剧本优化器
- 去除小说化语言
- 强化对话冲突
- 压缩冗余信息
- 提升节奏感

---

### 👤 模块三：角色管理模块

#### 3.1 角色卡创建器
- 角色基本信息（姓名、年龄、性别）
- 外貌描述
- 性格特征
- 角色类型（主角/配角/反派）

#### 3.2 角色关系构建器
- 自动识别关系（朋友/敌人/师徒/亲缘）
- 关系强度评估
- 关系变化追踪

#### 3.3 角色设定管理器
- 能力设定
- 物品设定
- 背景故事
- 成长弧线

#### 3.4 角色配音配置器
- 自动音色匹配
- 情感映射
- 语音参数调优

---

### 🎬 模块四：分镜设计模块

#### 4.1 场景分镜生成器
- 分镜类型选择（远景/中景/近景/特写）
- 运镜动作规划
- 镜头转换设计
- 每镜头6-10秒

#### 4.2 运镜动作规划器
- 固定镜头（Static）- 适合对话
- 推镜头（Dolly In）- 情绪增强
- 拉镜头（Dolly Out）- 场景转换
- 跟镜头（Tracking）- 动作场景
- 晃动镜头（Shaky）- 紧张时刻

#### 4.3 镜头转换设计器
- 切（Cut）- 直接切换
- 叠化（Fade）- 画面逐渐转换
- 划（Wipe）- 画面划过
- 闪（Flash）- 快速切换

#### 4.4 视觉描述生成器
- 主体清晰（谁/什么）
- 环境明确（在哪）
- 光线准确（什么光照）
- 角度明确（什么机位）
- 风格统一（AI漫剧风格）

---

### 🎵 模块五：音频生成模块

#### 5.1 故事讲解配音生成器
- 调用MiniMax TTS API
- 情感控制（根据剧情情绪）
- 语速调整（快节奏/慢节奏）
- 音质优化

#### 5.2 角色对话配音生成器
- 根据角色卡选择音色
- 根据情感标记调整参数
- 批量生成（并行处理）
- 质量检验

#### 5.3 音效生成器
- 环境音效（风声、雨声、城市噪音）
- 动作音效（拳击、爆炸、脚步声）
- 情绪音效（心跳声、闪光音效）

#### 5.4 背景音乐推荐器
- 根据情绪类型匹配
- 根据场景类型调整
- 避免与对话频率冲突
- 控制音量（-20dB）

---

### 🎥 模块六：视频生成模块

#### 6.1 角色图像生成器
- 调用MiniMax Image API
- 保持角色一致性
- 生成多种表情/姿势
- 批量生成

#### 6.2 场景图像生成器
- 调用MiniMax Image API
- 保持场景一致性
- 生成不同视角
- 光线变化

#### 6.3 分镜视频生成器
- 图像合成（角色+场景）
- 运镜实现（缩放、平移、倾斜）
- 镜头转换（切、叠化、划、闪）
- 时长控制（每镜头6-10秒）

#### 6.4 素材组织器
- 组织所有素材
- 打包输出
- 生成元数据

---

## 🎨 支持的风格

### 默认风格（default）
适用于各种类型的短剧，不特别强调某种风格

### 古风风格（ancient）
适用于古风、武侠、仙侠类短剧
- 语言风格：半文半白，古韵盎然
- 视觉风格：水墨风格，传统美学

### 现代风格（modern）
适用于现代都市、职场、校园类短剧
- 语言风格：口语化，贴近生活
- 视觉风格：扁平化，色彩鲜明

### 科幻风格（scifi）
适用于科幻、赛博朋克、未来世界类短剧
- 语言风格：科技感强，术语准确
- 视觉风格：赛博朋克，霓虹灯光

### 武侠风格（wuxia）
适用于武侠、江湖类短剧
- 语言风格：江湖气息，武侠韵味
- 视觉风格：水墨武侠，气势磅礴

---

## ⚙️ 配置说明

### 短剧规格配置

```python
DRAMA_CONFIG = {
    "video": {
        "aspect_ratio": "9:16",       # 竖屏比例
        "width": 1080,                # 视频宽度
        "height": 1920,               # 视频高度
        "resolution": "1080P",        # 分辨率
        "duration_per_scene": 6,       # 每镜头时长（秒）
        "scenes_per_episode": 6,       # 每集镜头数
        "episode_duration": 240        # 每集总时长（秒）
    },
    "audio": {
        "sample_rate": 32000,          # 采样率
        "format": "mp3",              # 音频格式
        "bitrate": 128000,            # 比特率
        "channel": 1,                 # 单声道
        "speed": 1.2,                 # 语速（快节奏）
        "volume": 0.8                 # 音量
    },
    "script": {
        "scenes_per_episode": [5, 8],  # 每集镜头数范围
        "scene_duration_range": [30, 60],  # 每镜头时长范围（秒）
        "hook_timing": 3,              # 钩子时间（秒）
        "twist_interval": 10,          # 反转间隔（秒）
        "compression_ratio": 0.7,       # 剧情压缩比例
        "min_conflict_level": 7         # 最低冲突强度
    }
}
```

---

## 🚀 开发计划

### Phase 1: 小说处理与剧本创作（Week 1-2）
- [ ] 小说分章读取处理
- [ ] 剧情梗概生成器
- [ ] 核心元素提取器
- [ ] 故事线拆解器
- [ ] 卡点剧情识别器
- [ ] 细纲生成器
- [ ] 集纲生成器
- [ ] 短剧正文生成器
- [ ] 剧本优化器

### Phase 2: 角色管理与分镜设计（Week 2-3）
- [ ] 角色卡创建器
- [ ] 角色关系构建器
- [ ] 角色设定管理器
- [ ] 角色配音配置器
- [ ] 场景分镜生成器
- [ ] 运镜动作规划器
- [ ] 镜头转换设计器
- [ ] 视觉描述生成器

### Phase 3: 音频生成（Week 3-4）
- [ ] 故事讲解配音生成器
- [ ] 角色对话配音生成器
- [ ] 音效生成器
- [ ] 背景音乐推荐器

### Phase 4: 视频生成与素材组织（Week 4-5）
- [ ] 角色图像生成器
- [ ] 场景图像生成器
- [ ] 分镜视频生成器
- [ ] 素材组织器

### Phase 5: 集成测试与优化（Week 5-6）
- [ ] 端到端工作流集成
- [ ] 质量检验工具
- [ ] 性能优化
- [ ] 用户文档编写

---

## 📚 文档索引

- [提示词管理系统文档](./docs/prompt_system.md)
- [提示词编写指南](./docs/prompt_writing_guide.md)
- [风格适配指南](./docs/style_adaptation_guide.md)
- [开发指南](./docs/development_guide.md)
- [API参考文档](./docs/api_reference.md)

## 📖 API技术文档

**重要说明**：项目开发中需要用到的AI技术API文档从以下地址查看：
- [MiniMax开放平台API文档](https://platform.minimaxi.com/docs/llms.txt)

该文档包含了MiniMax开放平台的完整API接口文档，涵盖了：
- 文本对话API
- 语音合成API
- 图像生成API
- 视频生成API
- 文件管理API
- 错误码查询等

---

## 🤝 贡献指南

欢迎贡献代码、报告问题、提出建议！

---

## 📄 许可证

MIT License

---

## 📞 联系方式

如有问题，请提交Issue或联系维护者。
